<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<body>
  <nav>
    <div class="nav-wrapper">
      <form>
        <div class="input-field">
          <input id="search" type="search" placeholder="Enter a location" required>
          <label for="search"><i class="material-icons">search</i></label>
          <i class="material-icons">close</i>
        </div>
      </form>
    </div>
  </nav>
  <div class="container">
    <div class="row">
      <div class="col s12">
        <div class="row">

          <div class="col m4">
            <div class="card">

              <div class="card-image">
                <img src="https://maps.gstatic.com/tactile/pane/default_geocode-1x.png">
                <span class="card-title">Card Title</span>
              </div>

              <div class="card-action">
                <a class="description-url-js" href="#" target="_blank">Description</a>
              </div>

            </div>
          </div>

        </div>

      </div>
    </div>
    <div class="row">

    </div>
    <div class="divider"></div>
    <div class="row">
      <div class="section">
        <h5>Saved Places</h5>
        <p>Stuff</p>
      </div>
    </div>

  </div>

  <script src="https://code.jquery.com/jquery-2.1.1.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/js/materialize.min.js" defer></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD4aEJM4HAQUyj3o7AFFVwlmCZLl5Y2kOs&libraries=places&callback=initMap" async defer></script>
  <script>
  var map;
  function initMap() {
    var input = document.getElementById('search')
    var types = document.getElementById('type-selector');
    var autocomplete = new google.maps.places.Autocomplete(input)

    autocomplete.addListener('place_changed', function() {
      var place = autocomplete.getPlace();
      console.log(place)
      $('.card-title').html(place.name)
      $('.description-url-js').attr('href', place.url)
      var photo = place.photos[0].getUrl({'maxWidth': 400, 'maxHeight': 400})
      $('.card-image img').attr('src', photo)

      var location = place.geometry.location
      var service = new google.maps.places.PlacesService(map)
      service.nearbySearch({
        location: location,
        radius: 500,
        type: []
      }, processResults);
    })

    function processResults(results, status, pagination) {
      if (status !== google.maps.places.PlacesServiceStatus.OK) {
        return;
      } else {
        createMarkers(results);

        // if (pagination.hasNextPage) {
        //   var moreButton = document.getElementById('more');
        //
        //   moreButton.disabled = false;
        //
        //   moreButton.addEventListener('click', function() {
        //     moreButton.disabled = true;
        //     pagination.nextPage();
        //   });
        // }
      }
    }

    function createMarkers(places) {
      var placesList = document.getElementById('places');

      for (var i = 0, place; place = places[i]; i++) {
        var image = {
          url: place.icon,
          size: new google.maps.Size(71, 71),
          origin: new google.maps.Point(0, 0),
          anchor: new google.maps.Point(17, 34),
          scaledSize: new google.maps.Size(25, 25)
        };

        var marker = new google.maps.Marker({
          map: map,
          icon: image,
          title: place.name,
          position: place.geometry.location
        });

        placesList.innerHTML += '<li>' + place.name + '</li>';

        bounds.extend(place.geometry.location);
      }
      map.fitBounds(bounds);
    }
  }
  </script>
</body>
</html>
